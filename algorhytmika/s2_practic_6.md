# Практическое занятие 6
  
## Приближенное решение уравнений методом Ньютона

Рассмотрим уранение вида

$$ f(x)=0 $$

где $f: [a;b] \to \mathbb{R}$ - некоторая, вообще говоря, не линейная функция.

Ранее такого рода уравнения мы решали методом деления отрезка пополам. Рассмотрим теперь ещё один метод, называемый методом Ньютона или методом касательных.

Согласно методу Ньютона получить приближенное решение рассматриваемого уравнения можно, воспользовавшись следующей рекуррентной формулой:

$$ x_{n+1}=x_n-\frac{f(x_n)}{f^\prime(x_n)} $$

где $n=0,1,2,3,..., \ \ \ x_0$ - заданное начальное приближение.

Вычисления по этой формуле следует прекращать при  достижении условия:

$$ |x_{n+1}-x_n|\le \varepsilon $$

где  $\varepsilon>0$ - заданная величина, определяющая погрешность вычислений.

Кроме того, при неудачном выборе начального приближения $x_0$ вычисляемая последовательность $x_n$ может не иметь предела (не сходиться к искомому корню).

Поэтому, чтобы избежать возможных зацикливаний, число итераций метода должно быть ограничено некоторой величиной (обычно не слишком большой).

## Вывод формулы метода Ньютона

Пусть $x_0$ - это некотрое начальное приближение неизвестного нам точного решения $x^*$ рассматриваемого уравнения ($f(x^*)=0$). И пусть функция $f(x)$ дважды дифференцируемая в некоторой окрестности своего корня, включающей точу $x_0$. Тогда, положив $\Delta=x^*-x_0$, и воспользовавшись формулой Тейлора для малой окрестности точки $x_0$, можем записать:

$$ f(x_0+\Delta)=f(x_0)+f^\prime(x_0)\Delta+o(\Delta) $$

Откуда, т.к. $x_0+\Delta=x^*$, имеем нелинейное уравнение:

$$ f(x^*)=f(x_0)+f^\prime(x_0)(x^*-x_0)+o(\Delta) = 0 $$

Если отбросить $o(\Delta)$, то это нелинейное уранение будет заменено линейным (относительно переменной, которую мы теперь обозначим $x_1$):

$$ f(x_0)+f^\prime(x_0)(x_1-x_0) = 0 $$

Решая это линейное уранение, получим формулу:

$$ x_1=x_0-\frac{f(x_0)}{f^\prime(x_0)} $$

Если при этом значение $x_1$ оказалось ещё ближе к искомому корню чем $x_0$, то процедуру можно повторить. Таким образом, приходим к следующей схеме вычислений: 

$$ x_{n+1}=x_n-\frac{f(x_n)}{f^\prime(x_n)} $$

где $n=0,1,2,3,...$.

**Замечание.** Метод Ньютона можно проиллюстрировать [геометрически](https://ru.wikipedia.org/wiki/Метод_Ньютона#Геометрическая_интерпретация). Это объесняет причину, по которой данный метод называют ещё методом касательных.

Полученную ранее рекуррентную формулу также лего получить и из чисто геометрических соображений.

## Обобщение метода Ньютона на случай комплексной переменной

Рассмотрим уравнение $f(z)=0$, где $f: \mathbb{C} \to \mathbb{C}$, - некоторая дифференциируемая функция комплесного переменного.

Определение производной в случае комплексной переменной внешне вполне совпадает с таковым для функции вещественной переменной:

$$ f'(z) = \lim_{\abs{\Delta z} \to 0} \frac{f(z+\Delta z)-f(z)}{\Delta z} $$

Из этого, в частности, следует, что $(z^n)'=nz^{n-1}$. Таким образом, многочлены, как функции комплексной переменной, можно дифферецировать по привычным правилам.

В результате оказывается, что полученная ранее рекуррентная формула применима в неизменном виде и в случае дифференцируемой функции комплексной переменной.

Ввиду сказанного, метод Ньютона можно использовать, например, для поиска комплексных кореней многочленов.

**Замечание.** Для вычисления корней уравнений для Julia имеется специальный пакет [Roots.jl]](https://docs.juliahub.com/Roots/o0Xsi/1.0.8/).

## Задания для программирования

1. Написать функцию, реализующую метод Ньютона

**Описание функции:**

```julia
"""
function newton(r::Function, x_0; epsilon = 1e-8, max_num_iter = 20)

Ищет корень уравнения f(x)=0
-- r(x)= -f(x)/f'(x)
-- x_0 - начальное приближение
-- epsilon > 0 - пераметр, определяющий точность вычислений
(критерй останова: |x - x_prev| = |r(x_prev)| <= epsilon)
-- max_num_iter - максимальное число итераций
"""
```

**Решение:**

```julia
function newton(r::Function, x; epsilon = 1e-8, max_num_iter = 20)
    num_iter = 0
    r_x = r(x)
    while num_iter < max_num_iter && abs(r_x) > epsilon
        x += r_x
        r_x = r(x)
        num_iter += 1
    end

    if abs(r_x) <= epsilon
        return x
    else
        return NaN
    end
end
```

2. С помощью функции newton решить уравнение $cos(x)=x$

**Решение.**

```julia
# f(x) = cos(x)-x

# f'(x) = -sin(x)-1

# r(x) = -f(x)/f'(x) = (cos(x)-x)/(sin(x)+1)

newton(x -> (cos(x)-x)/(sin(x)+1), 0.5)
```

3. С помощью функции `newton` и написанной ранее функции `polyval`, возвращающей значение многочлена (заданного вектором коэффициентов) и его производной в заданной точке, написать функцию, возвращающее приближенное значение комплексого корня многочлена, ближайшего к заданной точке комплексой плоскости.

Алгоритм вычисления многочлена, заданного массивом коэффициентов, и его производной в произвольной точке был рассмотрен в [лекции 1](s2_lecture_1.md).

Соответствующая функция может быть реализована следующим образом.

```julia
"""

"""
function polyval(P,x)
    dQ = 0
    Q = P[1]
    for i in 2:length(P)
        dQ = dQ*x + Q
        Q = Q*x + P[i]
    end
    return Q, dQ
end
```

**Указание.** Фактический параметр функционального типа функции newton в данном случае может быть определён следующим образом.

```julia
# P - внешняя переменная, содержащая коэффициенты многочлена, следующих в порядке убывания степеней

function r(x)
    y, dy = polyval(P, x)
    return -y/dy
end
```

**Замечание.** Функция r(x) представляет собой замыкание внешней переменной P.

4. Написать функцию, по заданному начальному приближению вычисляющую приближенное значение корня уравнения $f(x)=0$ в случае, когда нет практической возможности получит выражение для $f'(x)$, и вместо этого приходится пользоваться приближенной формулой:

$$f'(x) \approx \frac{f(x+h)-f(x)}{h}$$

где, например, можно положить $h = 1e-8$.

**Замечание.** Если здесь взять значение $h$ слишком маленьким, например, равным 1e-15, то, вместо теоретически ожидаемого увеличения точности вычисления производной, это может привести, наоборот, к её катастрофическому уменьшению, что связанно с возможным наличием погрешностей в вычисляемых значениях самой функции).

5. Воспользовавшись результатами пункта 4, визуализировать так называемую проблему Кэлли, состоящую в следующем.

Как известно уравнение
$$ z^3 - 1 = 0 $$
имеет 3 комплексных корня.

Требуется раскрасить комплексную полоскость (некоторую ее квадратную часть, содержащую круг единичного радиуса, на котором лежат корни уравнения) на три части, каждая из которых есть "бассейн притяжения" одного из трех корней уравнения.

Для этого можно взять наугад какую-либо точку из заданного квадрата (содержащего единичный круг), итерировать с этим началным значением по методу Ньютона, и если найденное в результате итераций значение окажется в некоторой достаточно малой окрестности k-го корня уравнения (k=0,1,2), то данная начальная точка должна быть окрашена в соответствующий цвет.

Задача будет решена в результате многократного применения этой процедуры к случайно выборанной начальной точке.

Для построения графиков можно воспользоваться графическим пакетом [Plots.jl](https://docs.juliaplots.org/latest/tutorial/)